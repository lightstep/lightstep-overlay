{"version":3,"sources":["../src/overlay.js"],"names":[],"mappings":"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","file":"overlay.js","sourcesContent":["const HOST_DIV_ID = 'lightstep_overlay';\n\nexport default function initialize(lightstepTracer, options = {}) {\n    if (!lightstepTracer) {\n        return;\n    }\n\n    if (typeof lightstepTracer.on !== 'function') {\n        console.warn('Incompatible tracer object', tracer); // eslint-disable-line\n        return;\n    }\n\n    let style = {\n        right  : '2em',\n        bottom : '2em',\n    };\n    if (options.bottom !== undefined) {\n        style.bottom = options.bottom;\n    }\n    if (options.right !== undefined) {\n        style.right = options.right;\n    }\n\n    lightstepTracer.on('report', (report) => {\n        let spans = report.span_records;\n        if (!spans || spans.length === 0) {\n            return;\n        }\n\n        let link;\n        let opts = lightstepTracer.options();\n        let kMaxSpans = 4;\n        let totalLinks = 0;\n\n        // Make a guess about whether we are reporting to a dev instance or not\n        // based on the ports being used.\n        let url;\n        if (opts.collector_port >= 9997 && opts.collector_port <= 9998) {\n            url = `http://${window.location.hostname}:${window.location.port}/${opts.access_token}/`;\n        } else {\n            let host = opts.collector_host;\n            if (host.match(/^collector[.-]/)) {\n                host = host.replace(/^collector([.-])/, 'app$1');\n            }\n            url = `https://${host}/${opts.access_token}/`;\n        }\n\n        // Check if the element is there, as some in-page script might have\n        // cleared the BODY, etc.\n        let overlay = document.getElementById(HOST_DIV_ID);\n        if (!overlay) {\n            let container = document.createElement('a');\n            container.href = `${url}latest?q=tracer.guid:${spans[0].runtime_guid}`;\n            container.style.position = 'fixed';\n            container.style.bottom = style.bottom;\n            container.style.right = style.right;\n            container.style.width = '3em';\n            container.style.height = '3em';\n            container.style.borderRadius = '3em';\n            container.style.cursor = 'pointer';\n            container.style.background = 'rgb(0, 163, 255)';\n            container.style.boxShadow = '0 0 0 1px #c4c4c4, 0 2px 20px 0 #e2e2e2';\n            container.style.transition = '.25s all cubic-bezier(.38,-0.19,.62,1.23)';\n            container.style.transform = 'scale(0)';\n            container.style.opacity = '0';\n\n\n            let btn = document.createElement('div');\n            btn.style.width = '100%';\n            btn.style.height = '100%';\n            btn.style.display = 'block';\n            btn.style.borderRadius = '3em';\n            btn.style.background = 'linear-gradient(to bottom right,#00d6ff,#3b6fcb 90%)';\n            btn.style.opacity = '0';\n            btn.style.boxShadow = '0 0 0 0 transparent';\n            btn.style.transition = '.2s all';\n\n            let text = document.createElement('p');\n            text.style.position = 'absolute';\n            text.style.top = '0';\n            text.style.left = '3.25em';\n            text.style.lineHeight = '3em';\n            text.style.fontFamily = '\"HelveticaNeue-Light\", \"Helvetica Neue Light\", \"Helvetica Neue\", Helvetica, Arial, \"Lucida Grande\", sans-serif'; // eslint-disable-line\n            text.style.color = '#FFF';\n            text.style.opacity = '0';\n            text.innerHTML = 'View traces';\n            text.style.transition = '.2s all';\n\n            let close = document.createElement('p');\n            close.style.position = 'absolute';\n            close.style.top = '0';\n            close.style.right = '0';\n            close.style.width = '2em';\n            close.style.borderRadius = '0 3rem 3rem 0';\n            close.style.borderLeft = '1px solid rgba(0,0,0,.15)';\n            close.style.boxShadow = 'inset 1px 0 0 0 rgba(255,255,255,.2)';\n            close.style.lineHeight = '3rem';\n            close.style.color = '#FFF';\n            close.style.opacity = '0';\n            close.style.fontSize = '1.5rem';\n            close.style.textAlign = 'center';\n            close.innerHTML = 'Ã—';\n            close.style.transition = '.2s all';\n\n\n            let logo = document.createElement('img');\n            logo.src = '/static/images/logo-white.svg';\n            logo.style.width = '2em';\n            logo.style.position = 'absolute';\n            logo.style.top = '.925em';\n            logo.style.left = '.5em';\n\n            container.onmouseenter = function (e) {\n                btn.style.background = 'linear-gradient(to bottom right,#00d6ff,#3b6fcb 90%)';\n                btn.style.opacity = '1';\n                container.style.boxShadow = 'rgb(196, 196, 196) 0px 0px 0px 1px, rgb(184, 184, 184) 0px 4px 30px 0px';\n                container.style.opacity = '1';\n                container.style.width = '12em';\n                text.style.opacity = '.9';\n                close.style.opacity = '.9';\n                text.style.color = 'rgba(255,255,255,.6)';\n                close.style.color = 'rgba(255,255,255,.6)';\n            };\n\n            container.onmouseleave = function (e) {\n                btn.style.boxShadow = '0 0 0 0 transparent';\n                btn.style.opacity = '0';\n                container.style.boxShadow = '0 0 0 1px #c4c4c4, 0 2px 20px 0 #e2e2e2';\n                container.style.width = '3em';\n                text.style.opacity = '0';\n                close.style.opacity = '0';\n            };\n\n            close.onmouseenter = function (e) {\n                close.style.color = 'rgba(255,255,255,.9)';\n                text.style.color = 'rgba(255,255,255,.6)';\n            };\n\n            close.onmouseleave = function (e) {\n                close.style.color = 'rgba(255,255,255,.6)';\n                text.style.color = 'rgba(255,255,255,.9)';\n            };\n\n            close.onclick = function (e) {\n                e.preventDefault();\n                e.stopPropagation();\n                container.style.transform = 'scale(0)';\n                container.style.opacity = '0';\n            };\n\n            container.appendChild(btn);\n            container.appendChild(logo);\n            container.appendChild(text);\n            container.appendChild(close);\n\n            overlay = document.createElement('div');\n            overlay.id = HOST_DIV_ID;\n            link = document.createElement('a');\n            link.href = url;\n            let title = document.createElement('div');\n            title.appendChild(link);\n            overlay.appendChild(title);\n\n            document.body.appendChild(overlay);\n            document.body.appendChild(container);\n\n            // Once all that stuff is done\n            // Note the getComputedStyle() call is necessary to force the DOM\n            // to update the element so the animation looks correct\n            container.style.opacity = '0';\n            window.getComputedStyle(container).opacity; // eslint-disable-line no-unused-expressions\n\n            container.style.transform = 'scale(1)';\n            container.style.opacity = '1';\n        }\n\n\n        for (let i = 0; i < overlay.childNodes.length; i++) {\n            let child = overlay.childNodes[i];\n            if (child.className === 'lightstep_span') {\n                totalLinks++;\n            }\n        }\n        // If we've already added kMaxSpans+1 lines below the\n        // 'header', then don't add anything else.\n        if (totalLinks > kMaxSpans) {\n            return;\n        }\n\n        // Do a primitive trace joining here: only show one link per\n        // trace (i.e. one link per set of spans that will be\n        // combined). We make the (possibly not true) assumptions that\n        // all spans in a trace will arrive in the same event and that\n        // all span share a join id (just to keep things simple).\n        let joinedSpans = [];\n        for (let i = 0; i < spans.length; i++) {\n            joinedSpans.push({\n                summary         : spans[i].span_name,\n                oldest_micros   : spans[i].oldest_micros,\n                youngest_micros : spans[i].youngest_micros,\n                span_guid       : spans[i].span_guid,\n            });\n        }\n        for (let i = 0; i < joinedSpans.length; i++) {\n            for (let j = i + 1; j < joinedSpans.length; j++) {\n                if ((joinedSpans[j].oldest_micros <= joinedSpans[i].youngest_micros &&\n                     joinedSpans[j].youngest_micros >= joinedSpans[i].oldest_micros)) {\n                    if (joinedSpans[j].oldest_micros < joinedSpans[i].oldest_micros) {\n                        joinedSpans[i].summary = `${joinedSpans[j].summary}, ${joinedSpans[i].summary}`;\n                        joinedSpans[i].oldest_micros = joinedSpans[j].oldest_micros;\n                    } else {\n                        joinedSpans[i].summary += `, ${joinedSpans[j].summary}`;\n                    }\n                    if (joinedSpans[j].youngest_micros > joinedSpans[i].youngest_micros) {\n                        joinedSpans[i].youngest_micros = joinedSpans[j].youngest_micros;\n                    }\n                    joinedSpans[j] = joinedSpans[joinedSpans.length - 1];\n                    joinedSpans = joinedSpans.slice(0, joinedSpans.length - 1);\n                    j = i;\n                }\n            }\n        }\n\n        for (let i = 0; i < joinedSpans.length && totalLinks <= kMaxSpans; i++) {\n            totalLinks++;\n        }\n    });\n}\n"]}